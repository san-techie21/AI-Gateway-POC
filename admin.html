<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Gateway | Enterprise Admin Console</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            /* Motilal Oswal Light Theme */
            --mo-blue: #2b2e8c;
            --mo-blue-light: #4a4db8;
            --mo-blue-dark: #1e2165;
            --mo-purple: #7978ba;
            --bg-white: #ffffff;
            --bg-light: #f5f7fa;
            --bg-gray: #e8ecf1;
            --text-dark: #1a1a2e;
            --text-gray: #5a6378;
            --text-muted: #8892a6;
            --border-light: #e0e5eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --card-bg: var(--bg-white);
            --sidebar-bg: var(--bg-white);
            --gradient-1: linear-gradient(135deg, #2b2e8c 0%, #7978ba 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-4: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --gradient-hero: linear-gradient(135deg, #2b2e8c 0%, #4a4db8 50%, #7978ba 100%);
            --shadow-sm: 0 2px 8px rgba(43, 46, 140, 0.06);
            --shadow-md: 0 4px 16px rgba(43, 46, 140, 0.08);
            --shadow-lg: 0 10px 40px rgba(43, 46, 140, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-light);
            padding: 24px 16px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-sm);
            overflow-y: auto;
        }

        .logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            margin-bottom: 32px;
        }

        .logo-icon {
            width: 140px;
            height: auto;
        }

        .logo-icon img {
            width: 100%;
            height: auto;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .logo-subtitle {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 0 12px;
            margin-bottom: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-gray);
            margin-bottom: 4px;
        }

        .nav-item:hover {
            background: rgba(43, 46, 140, 0.06);
            color: var(--mo-blue);
        }

        .nav-item.active {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 4px 15px rgba(43, 46, 140, 0.3);
        }

        .nav-item i {
            width: 20px;
            font-size: 16px;
        }

        .nav-item span {
            font-size: 14px;
            font-weight: 500;
        }

        .nav-item .badge {
            margin-left: auto;
            background: var(--danger);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .nav-item.active .badge {
            background: rgba(255,255,255,0.3);
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 16px;
            background: var(--bg-light);
            border-radius: 16px;
            border: 1px solid var(--border-light);
        }

        .mode-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .mode-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-gray);
        }

        .toggle-switch {
            position: relative;
            width: 56px;
            height: 28px;
            background: var(--danger);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.mock {
            background: var(--mo-blue);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.mock::after {
            left: 31px;
        }

        .mode-status {
            text-align: center;
            font-size: 12px;
            padding: 8px;
            border-radius: 8px;
            font-weight: 600;
        }

        .mode-status.block {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .mode-status.mock {
            background: rgba(43, 46, 140, 0.1);
            color: var(--mo-blue);
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 24px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 4px 15px rgba(43, 46, 140, 0.25);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(43, 46, 140, 0.35);
        }

        .btn-secondary {
            background: var(--bg-white);
            color: var(--text-gray);
            border: 1px solid var(--border-light);
        }

        .btn-secondary:hover {
            background: var(--bg-light);
            color: var(--mo-blue);
            border-color: var(--mo-blue);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Stats Grid - Smooth Enterprise Design */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid rgba(0, 0, 0, 0.04);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04), 0 4px 12px rgba(0, 0, 0, 0.03);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 8px 24px rgba(0, 0, 0, 0.06);
            border-color: rgba(0, 0, 0, 0.06);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .stat-card.total::before { background: #2b2e8c; }
        .stat-card.allowed::before { background: #10b981; }
        .stat-card.blocked::before { background: #ef4444; }
        .stat-card.local::before { background: #0ea5e9; }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 16px;
        }

        .stat-card.total .stat-icon {
            background: rgba(43, 46, 140, 0.08);
            color: #2b2e8c;
        }
        .stat-card.allowed .stat-icon {
            background: rgba(16, 185, 129, 0.08);
            color: #10b981;
        }
        .stat-card.blocked .stat-icon {
            background: rgba(239, 68, 68, 0.08);
            color: #ef4444;
        }
        .stat-card.local .stat-icon {
            background: rgba(14, 165, 233, 0.08);
            color: #0ea5e9;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 4px;
            letter-spacing: -0.5px;
            line-height: 1.2;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        .stat-card.total .stat-value { color: #2b2e8c; }
        .stat-card.allowed .stat-value { color: #10b981; }
        .stat-card.blocked .stat-value { color: #ef4444; }
        .stat-card.local .stat-value { color: #0ea5e9; }

        .stat-label {
            font-size: 13px;
            color: #64748b;
            font-weight: 500;
            letter-spacing: 0;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-dark);
        }

        .card-title i {
            color: var(--mo-blue);
        }

        /* Tabs for Configuration */
        .config-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 2px solid var(--border-light);
            padding-bottom: 12px;
            flex-wrap: wrap;
        }

        .config-tab {
            padding: 10px 20px;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-gray);
            transition: all 0.3s ease;
            border: 1px solid transparent;
            border-bottom: none;
            background: transparent;
        }

        .config-tab:hover {
            color: var(--mo-blue);
            background: rgba(43, 46, 140, 0.05);
        }

        .config-tab.active {
            background: var(--bg-white);
            color: var(--mo-blue);
            border-color: var(--border-light);
            border-bottom: 2px solid var(--bg-white);
            margin-bottom: -14px;
        }

        .config-tab i {
            margin-right: 8px;
        }

        .config-panel {
            display: none;
        }

        .config-panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .form-label .required {
            color: var(--danger);
        }

        .form-hint {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            font-size: 14px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            outline: none;
        }

        .form-input:focus {
            border-color: var(--mo-blue);
            box-shadow: 0 0 0 3px rgba(43, 46, 140, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-input.mono {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 13px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .form-row.three-col {
            grid-template-columns: repeat(3, 1fr);
        }

        /* Pattern Builder */
        .pattern-list {
            border: 1px solid var(--border-light);
            border-radius: 12px;
            overflow: hidden;
        }

        .pattern-item {
            display: grid;
            grid-template-columns: 200px 1fr 120px 80px;
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid var(--border-light);
            align-items: center;
        }

        .pattern-item:last-child {
            border-bottom: none;
        }

        .pattern-item.header {
            background: var(--bg-light);
            font-weight: 600;
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pattern-item input, .pattern-item select {
            padding: 8px 12px;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            font-size: 13px;
            background: var(--bg-white);
        }

        .pattern-item input:focus, .pattern-item select:focus {
            outline: none;
            border-color: var(--mo-blue);
        }

        .pattern-item .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .pattern-item .btn-icon.delete {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .pattern-item .btn-icon.delete:hover {
            background: var(--danger);
            color: white;
        }

        .pattern-item .btn-icon.test {
            background: rgba(43, 46, 140, 0.1);
            color: var(--mo-blue);
        }

        .pattern-item .btn-icon.test:hover {
            background: var(--mo-blue);
            color: white;
        }

        /* Role Matrix */
        .role-matrix {
            width: 100%;
            border-collapse: collapse;
        }

        .role-matrix th, .role-matrix td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        .role-matrix th {
            background: var(--bg-light);
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .role-matrix td {
            font-size: 14px;
        }

        .role-matrix tr:hover {
            background: rgba(43, 46, 140, 0.02);
        }

        .role-matrix .role-name {
            font-weight: 500;
            color: var(--text-dark);
        }

        .role-matrix .ad-group {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            color: var(--mo-blue);
            background: rgba(43, 46, 140, 0.05);
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* Toggle Checkbox - Clean Visible Style */
        .toggle-checkbox {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 26px;
        }

        .toggle-checkbox input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-checkbox .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #cbd5e1;
            transition: all 0.3s ease;
            border-radius: 26px;
        }

        .toggle-checkbox .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: all 0.3s ease;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .toggle-checkbox input:checked + .slider {
            background: #10b981;
        }

        .toggle-checkbox input:checked + .slider:before {
            transform: translateX(22px);
        }

        .toggle-checkbox:hover .slider {
            background: #94a3b8;
        }

        .toggle-checkbox input:checked:hover + .slider {
            background: #059669;
        }

        /* Integration Cards */
        .integration-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .integration-card {
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 20px;
        }

        .integration-card.connected {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        .integration-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .integration-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: var(--bg-white);
            color: var(--mo-blue);
        }

        .integration-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .integration-status {
            font-size: 12px;
            color: var(--text-muted);
        }

        .integration-status.connected {
            color: var(--success);
        }

        /* Chat Interface */
        .chat-container {
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: var(--bg-light);
            border-radius: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border-light);
        }

        .message {
            margin-bottom: 16px;
            display: flex;
            gap: 12px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
            color: white;
        }

        .message.user .message-avatar { background: var(--gradient-1); }
        .message.assistant .message-avatar { background: var(--gradient-3); }
        .message.system .message-avatar { background: var(--gradient-2); }
        .message.local .message-avatar { background: var(--gradient-1); }

        .message-content {
            max-width: 70%;
            padding: 14px 18px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: var(--mo-blue);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.assistant .message-content {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            color: var(--text-dark);
            border-bottom-left-radius: 4px;
        }

        .message.system .message-content {
            background: rgba(239, 68, 68, 0.08);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border-bottom-left-radius: 4px;
        }

        .message.local .message-content {
            background: rgba(43, 46, 140, 0.08);
            border: 1px solid rgba(43, 46, 140, 0.2);
            color: var(--mo-blue);
            border-bottom-left-radius: 4px;
        }

        .chat-input-container {
            display: flex;
            gap: 12px;
        }

        .chat-input {
            flex: 1;
            padding: 16px 20px;
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: 14px;
            color: var(--text-dark);
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            border-color: var(--mo-blue);
            box-shadow: 0 0 0 3px rgba(43, 46, 140, 0.1);
        }

        /* Scan Tester */
        .scan-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .scan-input {
            width: 100%;
            height: 250px;
            padding: 16px;
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: 14px;
            color: var(--text-dark);
            font-size: 14px;
            font-family: 'Monaco', 'Consolas', monospace;
            resize: none;
            outline: none;
        }

        .scan-input:focus {
            border-color: var(--mo-blue);
            box-shadow: 0 0 0 3px rgba(43, 46, 140, 0.1);
        }

        .scan-result {
            padding: 16px;
            background: var(--bg-light);
            border-radius: 14px;
            height: 250px;
            overflow-y: auto;
            border: 1px solid var(--border-light);
        }

        .detection-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: var(--bg-white);
            border-radius: 10px;
            margin-bottom: 8px;
            border: 1px solid var(--border-light);
        }

        .severity-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .severity-badge.critical { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .severity-badge.high { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .severity-badge.medium { background: rgba(43, 46, 140, 0.1); color: var(--mo-blue); }
        .severity-badge.low { background: rgba(16, 185, 129, 0.1); color: var(--success); }

        /* Logs Table */
        .logs-table {
            width: 100%;
            border-collapse: collapse;
        }

        .logs-table th {
            text-align: left;
            padding: 14px 16px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid var(--border-light);
            background: var(--bg-light);
        }

        .logs-table td {
            padding: 14px 16px;
            font-size: 14px;
            border-bottom: 1px solid var(--border-light);
            color: var(--text-gray);
        }

        .logs-table tr:hover {
            background: rgba(43, 46, 140, 0.03);
        }

        .status-pill {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pill.allowed { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .status-pill.blocked { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .status-pill.local { background: rgba(43, 46, 140, 0.1); color: var(--mo-blue); }

        /* Settings */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }

        .setting-group {
            background: var(--bg-light);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border-light);
        }

        .setting-group h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-dark);
        }

        .setting-group h3 i {
            color: var(--mo-blue);
        }

        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .setting-row:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-size: 14px;
            color: var(--text-gray);
        }

        .setting-input {
            padding: 8px 14px;
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            color: var(--text-dark);
            font-size: 14px;
            width: 200px;
            outline: none;
        }

        .setting-input:focus {
            border-color: var(--mo-blue);
            box-shadow: 0 0 0 3px rgba(43, 46, 140, 0.1);
        }

        /* Patterns Grid */
        .patterns-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .pattern-card {
            background: var(--bg-light);
            border-radius: 14px;
            padding: 16px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-light);
        }

        .pattern-card:hover {
            background: rgba(43, 46, 140, 0.05);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .pattern-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-dark);
        }

        .pattern-desc {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .pattern-regex {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 11px;
            color: var(--mo-blue);
            background: rgba(43, 46, 140, 0.08);
            padding: 6px 10px;
            border-radius: 6px;
            word-break: break-all;
        }

        /* Page Sections */
        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Activity Feed */
        .activity-feed {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px;
            background: var(--bg-light);
            border-radius: 12px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-light);
        }

        .activity-item:hover {
            background: rgba(43, 46, 140, 0.05);
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .activity-icon.allowed { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .activity-icon.blocked { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .activity-icon.local { background: rgba(43, 46, 140, 0.1); color: var(--mo-blue); }

        .activity-text {
            flex: 1;
        }

        .activity-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
            color: var(--text-dark);
        }

        .activity-time {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-light);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-light);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--mo-blue);
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .quick-action {
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-action:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
            border-color: var(--mo-blue);
        }

        .quick-action i {
            font-size: 28px;
            margin-bottom: 12px;
            color: var(--mo-blue);
        }

        .quick-action span {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
        }

        /* Hero Banner */
        .hero-banner {
            background: var(--gradient-hero);
            border-radius: 24px;
            padding: 32px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
            color: white;
        }

        .hero-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 60%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: heroGlow 10s ease-in-out infinite;
        }

        @keyframes heroGlow {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-10%, 10%); }
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .hero-subtitle {
            font-size: 16px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 20px;
        }

        .hero-stats {
            display: flex;
            gap: 40px;
        }

        .hero-stat {
            text-align: center;
        }

        .hero-stat-value {
            font-size: 28px;
            font-weight: 700;
        }

        .hero-stat-label {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .company-badge {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 11px;
            color: rgba(255,255,255,0.8);
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
        }

        .toast {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 16px 20px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
            box-shadow: var(--shadow-lg);
            color: var(--text-dark);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.info { border-left: 4px solid var(--mo-blue); }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-light);
            border-radius: 50%;
            border-top-color: var(--mo-blue);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            color: var(--border-light);
        }

        /* Info Box */
        .info-box {
            background: rgba(59, 130, 246, 0.08);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .info-box i {
            color: var(--info);
            font-size: 18px;
            margin-top: 2px;
        }

        .info-box p {
            font-size: 13px;
            color: var(--text-gray);
            line-height: 1.6;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .patterns-grid { grid-template-columns: repeat(2, 1fr); }
            .form-row.three-col { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 1024px) {
            .sidebar {
                width: 80px;
                padding: 16px 8px;
            }
            .logo-text, .logo-subtitle, .nav-label, .nav-item span, .sidebar-footer {
                display: none;
            }
            .nav-item {
                justify-content: center;
                padding: 14px;
            }
            .main-content {
                margin-left: 80px;
            }
            .scan-container { grid-template-columns: 1fr; }
            .settings-grid { grid-template-columns: 1fr; }
            .integration-grid { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-icon">
                <img src="/static/mo-logo.svg" alt="Motilal Oswal">
            </div>
            <div class="logo-text">AI Gateway</div>
            <div class="logo-subtitle">Admin Console</div>
        </div>

        <nav class="nav-section">
            <div class="nav-label">Main</div>
            <div class="nav-item active" data-page="dashboard">
                <i class="fas fa-chart-pie"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" data-page="config">
                <i class="fas fa-sliders-h"></i>
                <span>Configuration</span>
                <span class="badge">New</span>
            </div>
        </nav>

        <nav class="nav-section">
            <div class="nav-label">Test</div>
            <div class="nav-item" data-page="chat">
                <i class="fas fa-comments"></i>
                <span>Test Chat</span>
            </div>
            <div class="nav-item" data-page="scan">
                <i class="fas fa-search"></i>
                <span>Scan Tester</span>
            </div>
        </nav>

        <nav class="nav-section">
            <div class="nav-label">Monitor</div>
            <div class="nav-item" data-page="logs">
                <i class="fas fa-list"></i>
                <span>Request Logs</span>
            </div>
            <div class="nav-item" data-page="patterns">
                <i class="fas fa-fingerprint"></i>
                <span>Detection Patterns</span>
            </div>
        </nav>

        <nav class="nav-section">
            <div class="nav-label">System</div>
            <div class="nav-item" data-page="settings">
                <i class="fas fa-cog"></i>
                <span>API Settings</span>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="mode-toggle">
                <span class="mode-label">Sensitive Data</span>
                <div class="toggle-switch mock" id="modeToggle" onclick="toggleMode()"></div>
            </div>
            <div class="mode-status mock" id="modeStatus">
                <i class="fas fa-robot"></i> MOCK MODE
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Page -->
        <section class="page-section active" id="page-dashboard">
            <div class="header">
                <div>
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Real-time monitoring of AI gateway activity</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="refreshStats()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>

            <div class="hero-banner">
                <div class="hero-content">
                    <h2 class="hero-title">Enterprise AI Security</h2>
                    <p class="hero-subtitle">Protecting sensitive data from external AI exposure</p>
                    <div class="hero-stats">
                        <div class="hero-stat">
                            <div class="hero-stat-value" id="heroTotal">0</div>
                            <div class="hero-stat-label">Total Scanned</div>
                        </div>
                        <div class="hero-stat">
                            <div class="hero-stat-value" id="heroProtected">0</div>
                            <div class="hero-stat-label">Protected</div>
                        </div>
                        <div class="hero-stat">
                            <div class="hero-stat-value" id="heroDetections">0</div>
                            <div class="hero-stat-label">Detections</div>
                        </div>
                    </div>
                </div>
                <div class="company-badge">Motilal Oswal Financial Services</div>
            </div>

            <div class="stats-grid">
                <div class="stat-card total">
                    <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="stat-value" id="statTotal">0</div>
                    <div class="stat-label">Total Requests</div>
                </div>
                <div class="stat-card allowed">
                    <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-value" id="statAllowed">0</div>
                    <div class="stat-label">Allowed to External</div>
                </div>
                <div class="stat-card blocked">
                    <div class="stat-icon"><i class="fas fa-ban"></i></div>
                    <div class="stat-value" id="statBlocked">0</div>
                    <div class="stat-label">Blocked</div>
                </div>
                <div class="stat-card local">
                    <div class="stat-icon"><i class="fas fa-server"></i></div>
                    <div class="stat-value" id="statLocal">0</div>
                    <div class="stat-label">Routed to Local LLM</div>
                </div>
            </div>

            <div class="quick-actions">
                <div class="quick-action" onclick="showPage('config')">
                    <i class="fas fa-sliders-h"></i>
                    <span>Configuration</span>
                </div>
                <div class="quick-action" onclick="showPage('chat')">
                    <i class="fas fa-comment-dots"></i>
                    <span>Test Chat</span>
                </div>
                <div class="quick-action" onclick="showPage('logs')">
                    <i class="fas fa-history"></i>
                    <span>View Logs</span>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-bolt"></i> Recent Activity</h2>
                    <button class="btn btn-secondary btn-sm" onclick="loadRecentActivity()">
                        <i class="fas fa-refresh"></i>
                    </button>
                </div>
                <div class="activity-feed" id="activityFeed">
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>No recent activity</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Configuration Page -->
        <section class="page-section" id="page-config">
            <div class="header">
                <div>
                    <h1 class="page-title">Configuration</h1>
                    <p class="page-subtitle">Configure detection patterns, roles, integrations, and scale settings</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="exportConfig()">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button class="btn btn-primary" onclick="saveAllConfig()">
                        <i class="fas fa-save"></i> Save All Changes
                    </button>
                </div>
            </div>

            <div class="config-tabs">
                <div class="config-tab active" data-tab="patterns" onclick="showConfigTab('patterns')">
                    <i class="fas fa-fingerprint"></i>Sensitive Patterns
                </div>
                <div class="config-tab" data-tab="roles" onclick="showConfigTab('roles')">
                    <i class="fas fa-users-cog"></i>Roles & Access
                </div>
                <div class="config-tab" data-tab="ad" onclick="showConfigTab('ad')">
                    <i class="fas fa-sitemap"></i>AD Integration
                </div>
                <div class="config-tab" data-tab="siem" onclick="showConfigTab('siem')">
                    <i class="fas fa-shield-alt"></i>SIEM / QRadar
                </div>
                <div class="config-tab" data-tab="scale" onclick="showConfigTab('scale')">
                    <i class="fas fa-expand-arrows-alt"></i>Scale & Quotas
                </div>
            </div>

            <!-- Sensitive Patterns Tab -->
            <div class="config-panel active" id="panel-patterns">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-fingerprint"></i> Sensitive Data Patterns</h2>
                        <button class="btn btn-primary btn-sm" onclick="addPattern()">
                            <i class="fas fa-plus"></i> Add Pattern
                        </button>
                    </div>

                    <div class="info-box">
                        <i class="fas fa-info-circle"></i>
                        <p>Define regex patterns to detect sensitive data. These patterns will trigger blocking or local LLM routing. Standard patterns for PAN, Aadhaar, and API keys are pre-configured.</p>
                    </div>

                    <div class="pattern-list" id="patternList">
                        <div class="pattern-item header">
                            <span>Name</span>
                            <span>Regex Pattern</span>
                            <span>Severity</span>
                            <span>Actions</span>
                        </div>
                        <!-- Patterns will be loaded here -->
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-building"></i> Organization-Specific Patterns</h2>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Client Code Format</label>
                            <input type="text" class="form-input mono" id="patternClientCode" placeholder="e.g., MOT[0-9]{8}">
                            <p class="form-hint">Regex pattern for your client codes</p>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Demat Account Format</label>
                            <input type="text" class="form-input mono" id="patternDemat" placeholder="e.g., IN[0-9]{14}">
                            <p class="form-hint">Regex pattern for demat account numbers</p>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Trading Account Format</label>
                            <input type="text" class="form-input mono" id="patternTrading" placeholder="e.g., MOSL[A-Z0-9]{10}">
                            <p class="form-hint">Regex pattern for trading accounts</p>
                        </div>
                        <div class="form-group">
                            <label class="form-label">UCC (Unique Client Code) Format</label>
                            <input type="text" class="form-input mono" id="patternUCC" placeholder="e.g., [A-Z]{3}[0-9]{7}">
                            <p class="form-hint">Regex pattern for UCC codes</p>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Employee ID Format</label>
                            <input type="text" class="form-input mono" id="patternEmpId" placeholder="e.g., EMP[0-9]{6}">
                            <p class="form-hint">Regex pattern for employee IDs</p>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Internal Project Codes</label>
                            <input type="text" class="form-input mono" id="patternProject" placeholder="e.g., PRJ-[A-Z]{2}-[0-9]{4}">
                            <p class="form-hint">Regex pattern for project codes</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-exclamation-triangle"></i> UPSI Keywords</h2>
                    </div>
                    <p class="form-hint" style="margin-bottom: 16px;">Enter keywords that indicate Unpublished Price Sensitive Information. One keyword per line.</p>
                    <textarea class="form-input" id="upsiKeywords" style="height: 200px; font-family: monospace;" placeholder="merger
acquisition
quarterly results
dividend
board meeting
financial results
capital restructure
buyback"></textarea>
                </div>
            </div>

            <!-- Roles & Access Tab -->
            <div class="config-panel" id="panel-roles">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-users-cog"></i> Role-Based Access Control</h2>
                    </div>

                    <div class="info-box">
                        <i class="fas fa-info-circle"></i>
                        <p>Configure which roles can access external AI, local LLM, and the admin dashboard. These settings will be enforced based on AD group membership.</p>
                    </div>

                    <table class="role-matrix">
                        <thead>
                            <tr>
                                <th>Role</th>
                                <th>AD Group</th>
                                <th>External AI</th>
                                <th>Local LLM</th>
                                <th>Admin Dashboard</th>
                            </tr>
                        </thead>
                        <tbody id="roleMatrixBody">
                            <tr>
                                <td class="role-name">General Employee</td>
                                <td><input type="text" class="form-input" style="width: 180px;" placeholder="CN=AllEmployees,OU=..." data-role="general" data-field="ad_group"></td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked data-role="general" data-field="external">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" data-role="general" data-field="local">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" data-role="general" data-field="admin">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td class="role-name">Research Analyst</td>
                                <td><input type="text" class="form-input" style="width: 180px;" placeholder="CN=Research,OU=..." data-role="research" data-field="ad_group"></td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked data-role="research" data-field="external">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked data-role="research" data-field="local">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" data-role="research" data-field="admin">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td class="role-name">Strategy Team</td>
                                <td><input type="text" class="form-input" style="width: 180px;" placeholder="CN=Strategy,OU=..." data-role="strategy" data-field="ad_group"></td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked data-role="strategy" data-field="external">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked data-role="strategy" data-field="local">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" data-role="strategy" data-field="admin">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td class="role-name">Compliance Team</td>
                                <td><input type="text" class="form-input" style="width: 180px;" placeholder="CN=Compliance,OU=..." data-role="compliance" data-field="ad_group"></td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked data-role="compliance" data-field="external">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" data-role="compliance" data-field="local">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" data-role="compliance" data-field="admin">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td class="role-name">IT Admin</td>
                                <td><input type="text" class="form-input" style="width: 180px;" placeholder="CN=ITAdmins,OU=..." data-role="itadmin" data-field="ad_group"></td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked data-role="itadmin" data-field="external">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" data-role="itadmin" data-field="local">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" data-role="itadmin" data-field="admin">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td class="role-name">Security Team</td>
                                <td><input type="text" class="form-input" style="width: 180px;" placeholder="CN=Security,OU=..." data-role="security" data-field="ad_group"></td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked data-role="security" data-field="external">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" data-role="security" data-field="local">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked data-role="security" data-field="admin">
                                        <span class="slider"></span>
                                    </label>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- AD Integration Tab -->
            <div class="config-panel" id="panel-ad">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-sitemap"></i> Active Directory Configuration</h2>
                    </div>

                    <div class="info-box">
                        <i class="fas fa-info-circle"></i>
                        <p>Configure connection to your Active Directory for user authentication and group-based access control. Supports LDAP, SAML 2.0, and OAuth 2.0/OpenID Connect.</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Authentication Protocol</label>
                        <select class="form-input" id="adProtocol" style="width: 300px;">
                            <option value="saml">SAML 2.0</option>
                            <option value="oauth">OAuth 2.0 / OpenID Connect</option>
                            <option value="ldap">LDAP Direct Bind</option>
                            <option value="kerberos">Kerberos</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">AD Server / Domain Controller <span class="required">*</span></label>
                            <input type="text" class="form-input" id="adServer" placeholder="ldap://dc.motilal.local:389">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Base DN <span class="required">*</span></label>
                            <input type="text" class="form-input" id="adBaseDN" placeholder="DC=motilal,DC=local">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Bind User DN</label>
                            <input type="text" class="form-input" id="adBindUser" placeholder="CN=svc_aigateway,OU=ServiceAccounts,DC=...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Bind Password</label>
                            <input type="password" class="form-input" id="adBindPassword" placeholder="Enter service account password">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">User Search Filter</label>
                            <input type="text" class="form-input mono" id="adUserFilter" placeholder="(&(objectClass=user)(sAMAccountName={username}))">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Group Search Filter</label>
                            <input type="text" class="form-input mono" id="adGroupFilter" placeholder="(&(objectClass=group)(member={userDN}))">
                        </div>
                    </div>

                    <button class="btn btn-secondary" onclick="testADConnection()">
                        <i class="fas fa-plug"></i> Test Connection
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-key"></i> SAML Configuration</h2>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Identity Provider (IdP) Entity ID</label>
                            <input type="text" class="form-input" id="samlEntityId" placeholder="https://adfs.motilal.local/adfs/services/trust">
                        </div>
                        <div class="form-group">
                            <label class="form-label">IdP SSO URL</label>
                            <input type="text" class="form-input" id="samlSsoUrl" placeholder="https://adfs.motilal.local/adfs/ls/">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">IdP Certificate (PEM format)</label>
                        <textarea class="form-input mono" id="samlCertificate" style="height: 120px;" placeholder="-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----"></textarea>
                    </div>
                </div>
            </div>

            <!-- SIEM / QRadar Tab -->
            <div class="config-panel" id="panel-siem">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-shield-alt"></i> SIEM Integration</h2>
                    </div>

                    <div class="info-box">
                        <i class="fas fa-info-circle"></i>
                        <p>Configure log forwarding to your SIEM system for centralized security monitoring and compliance reporting. Supports IBM QRadar, Splunk, ELK, and Azure Sentinel.</p>
                    </div>

                    <div class="integration-grid">
                        <div class="integration-card" id="qradarCard">
                            <div class="integration-header">
                                <div class="integration-icon"><i class="fas fa-shield-alt"></i></div>
                                <div>
                                    <div class="integration-title">IBM QRadar</div>
                                    <div class="integration-status" id="qradarStatus">Not Connected</div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">QRadar Host</label>
                                <input type="text" class="form-input" id="qradarHost" placeholder="qradar.motilal.local">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Syslog Port</label>
                                <input type="number" class="form-input" id="qradarPort" value="514">
                            </div>
                            <div class="form-group">
                                <label class="form-label">API Token (for REST API)</label>
                                <input type="password" class="form-input" id="qradarToken" placeholder="Enter QRadar API token">
                            </div>
                            <button class="btn btn-sm btn-secondary" onclick="testQRadar()">
                                <i class="fas fa-plug"></i> Test Connection
                            </button>
                        </div>

                        <div class="integration-card">
                            <div class="integration-header">
                                <div class="integration-icon"><i class="fas fa-search"></i></div>
                                <div>
                                    <div class="integration-title">Splunk</div>
                                    <div class="integration-status">Optional</div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">HEC Endpoint</label>
                                <input type="text" class="form-input" id="splunkEndpoint" placeholder="https://splunk.motilal.local:8088">
                            </div>
                            <div class="form-group">
                                <label class="form-label">HEC Token</label>
                                <input type="password" class="form-input" id="splunkToken" placeholder="Enter Splunk HEC token">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-file-alt"></i> Log Forwarding Settings</h2>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Forwarding Mode</label>
                            <select class="form-input" id="logForwardMode">
                                <option value="realtime">Real-time (All Events)</option>
                                <option value="batch_hourly">Batch (Hourly)</option>
                                <option value="batch_daily">Batch (Daily)</option>
                                <option value="alerts_only">Alerts Only (Blocked Queries)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Log Format</label>
                            <select class="form-input" id="logFormat">
                                <option value="cef">CEF (Common Event Format)</option>
                                <option value="leef">LEEF (Log Event Extended Format)</option>
                                <option value="json">JSON</option>
                                <option value="syslog">Syslog RFC 5424</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Events to Forward</label>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" checked id="logAllowed"> Allowed Requests
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" checked id="logBlocked"> Blocked Requests
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" checked id="logLocal"> Local LLM Routed
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" checked id="logAuth"> Authentication Events
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="logAdmin"> Admin Actions
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scale & Quotas Tab -->
            <div class="config-panel" id="panel-scale">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-users"></i> User Scale</h2>
                    </div>

                    <div class="info-box">
                        <i class="fas fa-info-circle"></i>
                        <p>Configure user scale settings for capacity planning and resource allocation. These values help optimize the system for your organization's size.</p>
                    </div>

                    <div class="form-row three-col">
                        <div class="form-group">
                            <label class="form-label">Total Users</label>
                            <input type="number" class="form-input" id="scaleTotal" placeholder="100000">
                            <p class="form-hint">Total employees with access</p>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Expected Daily Active Users</label>
                            <input type="number" class="form-input" id="scaleDau" placeholder="10000">
                            <p class="form-hint">Average daily active users</p>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Peak Concurrent Users</label>
                            <input type="number" class="form-input" id="scalePeak" placeholder="1000">
                            <p class="form-hint">Maximum concurrent users</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-tachometer-alt"></i> Rate Limits & Quotas</h2>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Queries per User per Day</label>
                            <input type="number" class="form-input" id="quotaUserDaily" value="100">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Queries per User per Hour</label>
                            <input type="number" class="form-input" id="quotaUserHourly" value="20">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Max Requests per Minute (Global)</label>
                            <input type="number" class="form-input" id="quotaGlobalRpm" value="1000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Max Token Length per Query</label>
                            <input type="number" class="form-input" id="quotaMaxTokens" value="8000">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-rupee-sign"></i> Cost Controls</h2>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Monthly Budget (INR)</label>
                            <input type="number" class="form-input" id="budgetMonthly" placeholder="500000">
                            <p class="form-hint">Alert when 80% of budget is reached</p>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Cost Alert Email</label>
                            <input type="email" class="form-input" id="budgetAlertEmail" placeholder="it-alerts@motilal.com">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cost Optimization Strategy</label>
                        <select class="form-input" id="costStrategy" style="width: 400px;">
                            <option value="tiered">Tiered (Local LLM default, External for complex)</option>
                            <option value="local_first">Local First (External only on request)</option>
                            <option value="external_first">External First (Higher quality, higher cost)</option>
                            <option value="department_quota">Department-wise Quotas</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-layer-group"></i> Model Tier Configuration</h2>
                    </div>

                    <table class="role-matrix">
                        <thead>
                            <tr>
                                <th>Tier</th>
                                <th>Use Case</th>
                                <th>Model</th>
                                <th>Est. Cost/Query</th>
                                <th>Enabled</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="role-name">Default</td>
                                <td>General queries</td>
                                <td>
                                    <select class="form-input" style="width: 180px;">
                                        <option value="local:llama4">Local Llama 4</option>
                                        <option value="local:qwen">Local Qwen 2.5</option>
                                        <option value="groq:llama">Groq Llama</option>
                                    </select>
                                </td>
                                <td>Free / ~$0.0001</td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td class="role-name">Standard</td>
                                <td>Research queries</td>
                                <td>
                                    <select class="form-input" style="width: 180px;">
                                        <option value="groq:mixtral">Groq Mixtral</option>
                                        <option value="cerebras:llama">Cerebras Llama</option>
                                        <option value="together:mistral">Together Mistral</option>
                                    </select>
                                </td>
                                <td>~$0.001</td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td class="role-name">Premium</td>
                                <td>Complex analysis</td>
                                <td>
                                    <select class="form-input" style="width: 180px;">
                                        <option value="azure:gpt-4o">Azure GPT-4o</option>
                                        <option value="bedrock:claude">Bedrock Claude</option>
                                        <option value="openai:gpt-5">OpenAI GPT-5</option>
                                    </select>
                                </td>
                                <td>~$0.01</td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td class="role-name">Web Search</td>
                                <td>Research with citations</td>
                                <td>
                                    <select class="form-input" style="width: 180px;">
                                        <option value="perplexity:sonar">Perplexity Sonar</option>
                                        <option value="perplexity:sonar-pro">Perplexity Sonar Pro</option>
                                    </select>
                                </td>
                                <td>~$0.005</td>
                                <td>
                                    <label class="toggle-checkbox">
                                        <input type="checkbox" checked>
                                        <span class="slider"></span>
                                    </label>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Chat Page -->
        <section class="page-section" id="page-chat">
            <div class="header">
                <div>
                    <h1 class="page-title">Test Chat</h1>
                    <p class="page-subtitle">Test the AI gateway with sample queries</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="clearChat()">
                        <i class="fas fa-trash"></i> Clear
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message assistant">
                            <div class="message-avatar"><i class="fas fa-robot"></i></div>
                            <div class="message-content">
                                Welcome to AI Gateway! I'll scan your messages for sensitive data before sending to external AI. Try sending something with an Aadhaar number or API key to see it in action.
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="chatInput"
                               placeholder="Type a message... (Try: My Aadhaar is 2345 6789 0123)"
                               onkeypress="if(event.key==='Enter')sendChat()">
                        <button class="btn btn-primary" onclick="sendChat()">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-lightbulb"></i> Quick Test Examples</h2>
                </div>
                <div class="quick-actions">
                    <div class="quick-action" onclick="setTestInput('My Aadhaar number is 2345 6789 0123')">
                        <i class="fas fa-id-card"></i>
                        <span>Aadhaar Number</span>
                    </div>
                    <div class="quick-action" onclick="setTestInput('Process PAN ABCDE1234F for tax')">
                        <i class="fas fa-file-invoice"></i>
                        <span>PAN Card</span>
                    </div>
                    <div class="quick-action" onclick="setTestInput('api_key = \"sk-abc123xyz456789012345678901234567890\"')">
                        <i class="fas fa-key"></i>
                        <span>API Key</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Scan Page -->
        <section class="page-section" id="page-scan">
            <div class="header">
                <div>
                    <h1 class="page-title">Scan Tester</h1>
                    <p class="page-subtitle">Test content for sensitive data without making API calls</p>
                </div>
            </div>

            <div class="card">
                <div class="scan-container">
                    <div>
                        <h3 style="margin-bottom: 12px; font-size: 14px; color: var(--text-muted);">
                            <i class="fas fa-edit"></i> Input Content
                        </h3>
                        <textarea class="scan-input" id="scanInput"
                                  placeholder="Paste content here to scan for sensitive data..."></textarea>
                        <button class="btn btn-primary" style="margin-top: 12px; width: 100%;" onclick="runScan()">
                            <i class="fas fa-search"></i> Scan Content
                        </button>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 12px; font-size: 14px; color: var(--text-muted);">
                            <i class="fas fa-shield-alt"></i> Scan Results
                        </h3>
                        <div class="scan-result" id="scanResult">
                            <div class="empty-state">
                                <i class="fas fa-shield-alt"></i>
                                <p>Enter content and click Scan</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Logs Page -->
        <section class="page-section" id="page-logs">
            <div class="header">
                <div>
                    <h1 class="page-title">Request Logs</h1>
                    <p class="page-subtitle">View all processed requests and their status</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="loadLogs()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn btn-danger" onclick="clearLogs()">
                        <i class="fas fa-trash"></i> Clear All
                    </button>
                </div>
            </div>

            <div class="card">
                <table class="logs-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>User</th>
                            <th>Status</th>
                            <th>Provider</th>
                            <th>Detections</th>
                            <th>Content Preview</th>
                        </tr>
                    </thead>
                    <tbody id="logsTableBody">
                        <tr>
                            <td colspan="6">
                                <div class="empty-state">
                                    <i class="fas fa-inbox"></i>
                                    <p>No logs yet</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Patterns Page -->
        <section class="page-section" id="page-patterns">
            <div class="header">
                <div>
                    <h1 class="page-title">Detection Patterns</h1>
                    <p class="page-subtitle">All active patterns used for sensitive data detection</p>
                </div>
            </div>

            <div class="card">
                <div class="patterns-grid" id="patternsGrid">
                    <!-- Patterns will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Settings Page -->
        <section class="page-section" id="page-settings">
            <div class="header">
                <div>
                    <h1 class="page-title">API Settings</h1>
                    <p class="page-subtitle">Configure API keys for AI providers</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </div>

            <div class="settings-grid">
                <div class="card">
                    <div class="setting-group">
                        <h3><i class="fas fa-key"></i> API Configuration</h3>
                        <div class="setting-row">
                            <span class="setting-label">Active Provider</span>
                            <select class="setting-input" id="settingProvider">
                                <optgroup label="Enterprise Cloud">
                                    <option value="azure_openai">Azure OpenAI (Mumbai)</option>
                                    <option value="aws_bedrock">AWS Bedrock (Mumbai)</option>
                                </optgroup>
                                <optgroup label="Major LLMs">
                                    <option value="openai">OpenAI (GPT-4o, GPT-5)</option>
                                    <option value="claude">Anthropic Claude</option>
                                    <option value="gemini">Google Gemini</option>
                                    <option value="deepseek">DeepSeek</option>
                                    <option value="mistral">Mistral AI</option>
                                    <option value="grok">xAI Grok</option>
                                </optgroup>
                                <optgroup label="Fast Inference">
                                    <option value="groq">Groq (Ultra-Fast)</option>
                                    <option value="cerebras">Cerebras (Ultra-Fast)</option>
                                    <option value="sambanova">SambaNova</option>
                                    <option value="fireworks">Fireworks AI</option>
                                    <option value="together">Together AI</option>
                                </optgroup>
                                <optgroup label="Web Search">
                                    <option value="perplexity">Perplexity AI</option>
                                </optgroup>
                                <optgroup label="Local">
                                    <option value="ollama">Ollama (Local)</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">API Key</span>
                            <input type="password" class="setting-input" id="settingAPIKey" placeholder="Enter API key...">
                        </div>
                        <button class="btn btn-primary" onclick="saveProviderKey()" style="margin-top: 10px;">
                            <i class="fas fa-save"></i> Save API Key
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="setting-group">
                        <h3><i class="fas fa-tachometer-alt"></i> Limits</h3>
                        <div class="setting-row">
                            <span class="setting-label">Max Content Size (MB)</span>
                            <input type="number" class="setting-input" id="settingMaxSize" value="1">
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">Requests/Minute</span>
                            <input type="number" class="setting-input" id="settingRateLimit" value="10">
                        </div>
                    </div>
                </div>

                <div class="card" style="grid-column: span 2;">
                    <div class="setting-group">
                        <h3><i class="fas fa-ban"></i> Blocked Keywords</h3>
                        <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 12px;">
                            One keyword per line. These will trigger blocking/local routing.
                        </p>
                        <textarea class="scan-input" id="settingKeywords" style="height: 150px;"
                                  placeholder="confidential&#10;internal only&#10;UPSI"></textarea>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        const API_URL = '';
        let currentMode = 'mock';
        const CONFIG_STORAGE_KEY = 'aigateway_admin_config';

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const page = item.dataset.page;
                showPage(page);
            });
        });

        function showPage(page) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.querySelector(`[data-page="${page}"]`).classList.add('active');

            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.getElementById(`page-${page}`).classList.add('active');

            if (page === 'logs') loadLogs();
            if (page === 'patterns') loadPatterns();
            if (page === 'settings') loadSettings();
            if (page === 'dashboard') refreshStats();
            if (page === 'config') loadConfigFromStorage();
        }

        // Config Tabs
        function showConfigTab(tab) {
            document.querySelectorAll('.config-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');

            document.querySelectorAll('.config-panel').forEach(p => p.classList.remove('active'));
            document.getElementById(`panel-${tab}`).classList.add('active');
        }

        // Pattern Management
        let customPatterns = [];

        function loadDefaultPatterns() {
            return [
                { name: 'Aadhaar Number', pattern: '[2-9][0-9]{3}\\s?[0-9]{4}\\s?[0-9]{4}', severity: 'CRITICAL' },
                { name: 'PAN Card', pattern: '[A-Z]{5}[0-9]{4}[A-Z]', severity: 'CRITICAL' },
                { name: 'API Key (Generic)', pattern: '(api[_-]?key|apikey)[\\s]*[=:][\\s]*["\']?[a-zA-Z0-9_-]{20,}', severity: 'HIGH' },
                { name: 'OpenAI API Key', pattern: 'sk-[a-zA-Z0-9]{32,}', severity: 'CRITICAL' },
                { name: 'AWS Access Key', pattern: 'AKIA[0-9A-Z]{16}', severity: 'CRITICAL' },
                { name: 'Credit Card', pattern: '\\b(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14})\\b', severity: 'CRITICAL' },
                { name: 'Email Address', pattern: '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}', severity: 'MEDIUM' },
                { name: 'Phone (India)', pattern: '(?:\\+91|0)?[6-9][0-9]{9}', severity: 'MEDIUM' }
            ];
        }

        function renderPatternList() {
            const container = document.getElementById('patternList');
            const patterns = [...loadDefaultPatterns(), ...customPatterns];

            let html = `<div class="pattern-item header">
                <span>Name</span>
                <span>Regex Pattern</span>
                <span>Severity</span>
                <span>Actions</span>
            </div>`;

            patterns.forEach((p, i) => {
                const isCustom = i >= loadDefaultPatterns().length;
                html += `
                    <div class="pattern-item">
                        <input type="text" value="${p.name}" ${isCustom ? '' : 'readonly'} data-index="${i}" data-field="name">
                        <input type="text" value="${p.pattern}" class="mono" ${isCustom ? '' : 'readonly'} data-index="${i}" data-field="pattern">
                        <select ${isCustom ? '' : 'disabled'} data-index="${i}" data-field="severity">
                            <option value="LOW" ${p.severity === 'LOW' ? 'selected' : ''}>Low</option>
                            <option value="MEDIUM" ${p.severity === 'MEDIUM' ? 'selected' : ''}>Medium</option>
                            <option value="HIGH" ${p.severity === 'HIGH' ? 'selected' : ''}>High</option>
                            <option value="CRITICAL" ${p.severity === 'CRITICAL' ? 'selected' : ''}>Critical</option>
                        </select>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn-icon test" onclick="testPattern(${i})" title="Test Pattern">
                                <i class="fas fa-play"></i>
                            </button>
                            ${isCustom ? `<button class="btn-icon delete" onclick="deletePattern(${i - loadDefaultPatterns().length})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>` : ''}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function addPattern() {
            customPatterns.push({
                name: 'New Pattern',
                pattern: '',
                severity: 'MEDIUM'
            });
            renderPatternList();
            showToast('New pattern added. Configure and save.', 'info');
        }

        function deletePattern(index) {
            customPatterns.splice(index, 1);
            renderPatternList();
            showToast('Pattern deleted', 'success');
        }

        function testPattern(index) {
            const patterns = [...loadDefaultPatterns(), ...customPatterns];
            const pattern = patterns[index];
            const testText = prompt(`Test pattern: ${pattern.name}\n\nEnter test text:`);
            if (testText) {
                try {
                    const regex = new RegExp(pattern.pattern, 'gi');
                    const matches = testText.match(regex);
                    if (matches) {
                        showToast(`Found ${matches.length} match(es): ${matches.join(', ')}`, 'success');
                    } else {
                        showToast('No matches found', 'info');
                    }
                } catch (e) {
                    showToast('Invalid regex pattern: ' + e.message, 'error');
                }
            }
        }

        // Config Save/Load
        function saveAllConfig() {
            const config = {
                patterns: {
                    clientCode: document.getElementById('patternClientCode').value,
                    demat: document.getElementById('patternDemat').value,
                    trading: document.getElementById('patternTrading').value,
                    ucc: document.getElementById('patternUCC').value,
                    empId: document.getElementById('patternEmpId').value,
                    project: document.getElementById('patternProject').value,
                    customPatterns: customPatterns
                },
                upsiKeywords: document.getElementById('upsiKeywords').value,
                roles: collectRoleConfig(),
                ad: {
                    protocol: document.getElementById('adProtocol').value,
                    server: document.getElementById('adServer').value,
                    baseDN: document.getElementById('adBaseDN').value,
                    bindUser: document.getElementById('adBindUser').value,
                    userFilter: document.getElementById('adUserFilter').value,
                    groupFilter: document.getElementById('adGroupFilter').value,
                    samlEntityId: document.getElementById('samlEntityId').value,
                    samlSsoUrl: document.getElementById('samlSsoUrl').value,
                    samlCertificate: document.getElementById('samlCertificate').value
                },
                siem: {
                    qradarHost: document.getElementById('qradarHost').value,
                    qradarPort: document.getElementById('qradarPort').value,
                    splunkEndpoint: document.getElementById('splunkEndpoint').value,
                    logForwardMode: document.getElementById('logForwardMode').value,
                    logFormat: document.getElementById('logFormat').value,
                    logAllowed: document.getElementById('logAllowed').checked,
                    logBlocked: document.getElementById('logBlocked').checked,
                    logLocal: document.getElementById('logLocal').checked,
                    logAuth: document.getElementById('logAuth').checked,
                    logAdmin: document.getElementById('logAdmin').checked
                },
                scale: {
                    total: document.getElementById('scaleTotal').value,
                    dau: document.getElementById('scaleDau').value,
                    peak: document.getElementById('scalePeak').value,
                    quotaUserDaily: document.getElementById('quotaUserDaily').value,
                    quotaUserHourly: document.getElementById('quotaUserHourly').value,
                    quotaGlobalRpm: document.getElementById('quotaGlobalRpm').value,
                    quotaMaxTokens: document.getElementById('quotaMaxTokens').value,
                    budgetMonthly: document.getElementById('budgetMonthly').value,
                    budgetAlertEmail: document.getElementById('budgetAlertEmail').value,
                    costStrategy: document.getElementById('costStrategy').value
                },
                savedAt: new Date().toISOString()
            };

            localStorage.setItem(CONFIG_STORAGE_KEY, JSON.stringify(config));

            // Also try to save to backend
            fetch(`${API_URL}/api/config`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(config)
            }).catch(e => console.log('Backend save failed, using localStorage'));

            showToast('Configuration saved successfully', 'success');
        }

        function collectRoleConfig() {
            const roles = {};
            document.querySelectorAll('#roleMatrixBody tr').forEach(row => {
                const roleInputs = row.querySelectorAll('input');
                if (roleInputs.length > 0) {
                    const role = roleInputs[0].dataset.role;
                    if (role) {
                        roles[role] = {
                            ad_group: row.querySelector(`input[data-role="${role}"][data-field="ad_group"]`)?.value || '',
                            external: row.querySelector(`input[data-role="${role}"][data-field="external"]`)?.checked || false,
                            local: row.querySelector(`input[data-role="${role}"][data-field="local"]`)?.checked || false,
                            admin: row.querySelector(`input[data-role="${role}"][data-field="admin"]`)?.checked || false
                        };
                    }
                }
            });
            return roles;
        }

        function loadConfigFromStorage() {
            const saved = localStorage.getItem(CONFIG_STORAGE_KEY);
            if (saved) {
                try {
                    const config = JSON.parse(saved);

                    // Load patterns
                    if (config.patterns) {
                        document.getElementById('patternClientCode').value = config.patterns.clientCode || '';
                        document.getElementById('patternDemat').value = config.patterns.demat || '';
                        document.getElementById('patternTrading').value = config.patterns.trading || '';
                        document.getElementById('patternUCC').value = config.patterns.ucc || '';
                        document.getElementById('patternEmpId').value = config.patterns.empId || '';
                        document.getElementById('patternProject').value = config.patterns.project || '';
                        customPatterns = config.patterns.customPatterns || [];
                    }

                    document.getElementById('upsiKeywords').value = config.upsiKeywords || '';

                    // Load roles
                    if (config.roles) {
                        Object.keys(config.roles).forEach(role => {
                            const r = config.roles[role];
                            const adInput = document.querySelector(`input[data-role="${role}"][data-field="ad_group"]`);
                            if (adInput) adInput.value = r.ad_group || '';

                            const extCheck = document.querySelector(`input[data-role="${role}"][data-field="external"]`);
                            if (extCheck) extCheck.checked = r.external;

                            const localCheck = document.querySelector(`input[data-role="${role}"][data-field="local"]`);
                            if (localCheck) localCheck.checked = r.local;

                            const adminCheck = document.querySelector(`input[data-role="${role}"][data-field="admin"]`);
                            if (adminCheck) adminCheck.checked = r.admin;
                        });
                    }

                    // Load AD config
                    if (config.ad) {
                        document.getElementById('adProtocol').value = config.ad.protocol || 'saml';
                        document.getElementById('adServer').value = config.ad.server || '';
                        document.getElementById('adBaseDN').value = config.ad.baseDN || '';
                        document.getElementById('adBindUser').value = config.ad.bindUser || '';
                        document.getElementById('adUserFilter').value = config.ad.userFilter || '';
                        document.getElementById('adGroupFilter').value = config.ad.groupFilter || '';
                        document.getElementById('samlEntityId').value = config.ad.samlEntityId || '';
                        document.getElementById('samlSsoUrl').value = config.ad.samlSsoUrl || '';
                        document.getElementById('samlCertificate').value = config.ad.samlCertificate || '';
                    }

                    // Load SIEM config
                    if (config.siem) {
                        document.getElementById('qradarHost').value = config.siem.qradarHost || '';
                        document.getElementById('qradarPort').value = config.siem.qradarPort || '514';
                        document.getElementById('splunkEndpoint').value = config.siem.splunkEndpoint || '';
                        document.getElementById('logForwardMode').value = config.siem.logForwardMode || 'realtime';
                        document.getElementById('logFormat').value = config.siem.logFormat || 'cef';
                        document.getElementById('logAllowed').checked = config.siem.logAllowed !== false;
                        document.getElementById('logBlocked').checked = config.siem.logBlocked !== false;
                        document.getElementById('logLocal').checked = config.siem.logLocal !== false;
                        document.getElementById('logAuth').checked = config.siem.logAuth !== false;
                        document.getElementById('logAdmin').checked = config.siem.logAdmin || false;
                    }

                    // Load scale config
                    if (config.scale) {
                        document.getElementById('scaleTotal').value = config.scale.total || '';
                        document.getElementById('scaleDau').value = config.scale.dau || '';
                        document.getElementById('scalePeak').value = config.scale.peak || '';
                        document.getElementById('quotaUserDaily').value = config.scale.quotaUserDaily || '100';
                        document.getElementById('quotaUserHourly').value = config.scale.quotaUserHourly || '20';
                        document.getElementById('quotaGlobalRpm').value = config.scale.quotaGlobalRpm || '1000';
                        document.getElementById('quotaMaxTokens').value = config.scale.quotaMaxTokens || '8000';
                        document.getElementById('budgetMonthly').value = config.scale.budgetMonthly || '';
                        document.getElementById('budgetAlertEmail').value = config.scale.budgetAlertEmail || '';
                        document.getElementById('costStrategy').value = config.scale.costStrategy || 'tiered';
                    }

                    renderPatternList();
                } catch (e) {
                    console.error('Failed to load config', e);
                }
            } else {
                renderPatternList();
            }
        }

        function exportConfig() {
            const saved = localStorage.getItem(CONFIG_STORAGE_KEY);
            if (saved) {
                const blob = new Blob([saved], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ai-gateway-config-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('Configuration exported', 'success');
            } else {
                showToast('No configuration to export', 'error');
            }
        }

        function testADConnection() {
            showToast('Testing AD connection...', 'info');
            setTimeout(() => {
                showToast('AD connection test successful (simulated)', 'success');
            }, 1500);
        }

        function testQRadar() {
            showToast('Testing QRadar connection...', 'info');
            setTimeout(() => {
                showToast('QRadar connection test successful (simulated)', 'success');
                document.getElementById('qradarStatus').textContent = 'Connected';
                document.getElementById('qradarStatus').classList.add('connected');
                document.getElementById('qradarCard').classList.add('connected');
            }, 1500);
        }

        // Mode Toggle
        async function toggleMode() {
            currentMode = currentMode === 'mock' ? 'block' : 'mock';
            updateModeUI();

            try {
                await fetch(`${API_URL}/api/config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ local_llm_mode: currentMode })
                });
                showToast(`Mode changed to ${currentMode.toUpperCase()}`, 'success');
            } catch (e) {
                showToast('Failed to update mode', 'error');
            }
        }

        function updateModeUI() {
            const toggle = document.getElementById('modeToggle');
            const status = document.getElementById('modeStatus');

            if (currentMode === 'mock') {
                toggle.classList.add('mock');
                status.className = 'mode-status mock';
                status.innerHTML = '<i class="fas fa-robot"></i> MOCK MODE';
            } else {
                toggle.classList.remove('mock');
                status.className = 'mode-status block';
                status.innerHTML = '<i class="fas fa-ban"></i> BLOCK MODE';
            }
        }

        // Stats
        async function refreshStats() {
            try {
                const res = await fetch(`${API_URL}/api/logs/stats`);
                const data = await res.json();

                const total = data.total_requests || 0;
                const allowed = data.by_action?.ALLOWED || 0;
                const blocked = data.by_action?.BLOCKED || 0;
                const local = data.by_action?.ROUTED_LOCAL_LLM || 0;

                animateNumber('statTotal', total);
                animateNumber('statAllowed', allowed);
                animateNumber('statBlocked', blocked);
                animateNumber('statLocal', local);

                animateNumber('heroTotal', total);
                animateNumber('heroProtected', blocked + local);
                animateNumber('heroDetections', Object.values(data.detection_types || {}).reduce((a, b) => a + b, 0));

                loadRecentActivity();
            } catch (e) {
                console.error('Failed to load stats', e);
            }
        }

        function animateNumber(id, target) {
            const el = document.getElementById(id);
            const current = parseInt(el.textContent) || 0;
            const diff = target - current;
            const steps = 20;
            const stepValue = diff / steps;
            let step = 0;

            const interval = setInterval(() => {
                step++;
                el.textContent = Math.round(current + stepValue * step);
                if (step >= steps) {
                    el.textContent = target;
                    clearInterval(interval);
                }
            }, 30);
        }

        // Chat
        async function sendChat() {
            const input = document.getElementById('chatInput');
            const content = input.value.trim();
            if (!content) return;

            addMessage('user', content);
            input.value = '';

            try {
                const res = await fetch(`${API_URL}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [{ role: 'user', content }],
                        user_id: 'dashboard_user'
                    })
                });

                const data = await res.json();

                if (data.status === 'ALLOWED') {
                    addMessage('assistant', data.response || 'Response received');
                } else if (data.status === 'ROUTED_TO_LOCAL_LLM') {
                    addMessage('local', data.response, data.detections);
                } else if (data.status === 'BLOCKED') {
                    addMessage('system', `BLOCKED: ${data.message}\n\nDetected: ${data.detections?.map(d => d.description).join(', ')}`);
                } else {
                    addMessage('system', data.error || data.message || 'Unknown error');
                }

                refreshStats();
            } catch (e) {
                addMessage('system', 'Connection error: ' + e.message);
            }
        }

        function addMessage(type, content, detections) {
            const container = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = `message ${type}`;

            let icon = 'robot';
            if (type === 'user') icon = 'user';
            if (type === 'system') icon = 'exclamation-triangle';
            if (type === 'local') icon = 'server';

            let detectionsHtml = '';
            if (detections && detections.length > 0) {
                detectionsHtml = '<div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(0,0,0,0.1);">' +
                    '<strong>Detected:</strong> ' + detections.map(d =>
                        `<span class="severity-badge ${d.severity.toLowerCase()}">${d.type}</span>`
                    ).join(' ') + '</div>';
            }

            div.innerHTML = `
                <div class="message-avatar"><i class="fas fa-${icon}"></i></div>
                <div class="message-content">${content.replace(/\n/g, '<br>')}${detectionsHtml}</div>
            `;

            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function clearChat() {
            const container = document.getElementById('chatMessages');
            container.innerHTML = `
                <div class="message assistant">
                    <div class="message-avatar"><i class="fas fa-robot"></i></div>
                    <div class="message-content">Chat cleared. Ready for new tests.</div>
                </div>
            `;
        }

        function setTestInput(text) {
            document.getElementById('chatInput').value = text;
            document.getElementById('chatInput').focus();
        }

        // Scan
        async function runScan() {
            const content = document.getElementById('scanInput').value;
            const resultDiv = document.getElementById('scanResult');

            if (!content.trim()) {
                showToast('Please enter content to scan', 'error');
                return;
            }

            resultDiv.innerHTML = '<div class="loading"></div>';

            try {
                const res = await fetch(`${API_URL}/api/scan`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content })
                });

                const data = await res.json();
                const scan = data.scan_result;

                if (!scan.is_sensitive) {
                    resultDiv.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-check-circle" style="font-size: 48px; color: var(--success); margin-bottom: 16px;"></i>
                            <p style="font-size: 16px; color: var(--success);">No sensitive data detected</p>
                            <p style="color: var(--text-muted); margin-top: 8px;">Content would be sent to: ${data.would_route_to}</p>
                        </div>
                    `;
                } else {
                    let html = `
                        <div style="padding: 12px; background: rgba(239, 68, 68, 0.08); border-radius: 10px; margin-bottom: 16px; border: 1px solid rgba(239, 68, 68, 0.2);">
                            <i class="fas fa-exclamation-triangle" style="color: var(--danger);"></i>
                            <strong style="color: var(--danger);"> Sensitive Data Detected</strong>
                            <p style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                                Severity: ${scan.severity} | Would route to: ${data.would_route_to}
                            </p>
                        </div>
                    `;

                    scan.detections.forEach(d => {
                        html += `
                            <div class="detection-item">
                                <span class="severity-badge ${d.severity.toLowerCase()}">${d.severity}</span>
                                <div>
                                    <strong style="color: var(--text-dark);">${d.type}</strong>
                                    <p style="font-size: 12px; color: var(--text-muted);">${d.description}</p>
                                    ${d.matched_text ? `<code style="font-size: 11px; color: var(--danger); background: rgba(239, 68, 68, 0.08); padding: 2px 6px; border-radius: 4px;">${d.matched_text}</code>` : ''}
                                </div>
                            </div>
                        `;
                    });

                    resultDiv.innerHTML = html;
                }
            } catch (e) {
                resultDiv.innerHTML = `<p style="color: var(--danger);">Error: ${e.message}</p>`;
            }
        }

        // Logs
        async function loadLogs() {
            try {
                const res = await fetch(`${API_URL}/api/logs?limit=50`);
                const data = await res.json();

                const tbody = document.getElementById('logsTableBody');

                if (!data.logs || data.logs.length === 0) {
                    tbody.innerHTML = `
                        <tr><td colspan="6">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>No logs yet</p>
                            </div>
                        </td></tr>
                    `;
                    return;
                }

                tbody.innerHTML = data.logs.map(log => {
                    let statusClass = 'allowed';
                    if (log.action === 'BLOCKED') statusClass = 'blocked';
                    if (log.action === 'ROUTED_LOCAL_LLM') statusClass = 'local';

                    const time = new Date(log.timestamp).toLocaleString();
                    const preview = (log.content_preview || '').substring(0, 50) + '...';

                    return `
                        <tr>
                            <td>${time}</td>
                            <td>${log.user_id || 'anonymous'}</td>
                            <td><span class="status-pill ${statusClass}">${log.action}</span></td>
                            <td>${log.provider || '-'}</td>
                            <td>${log.detections_count || 0}</td>
                            <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">${preview}</td>
                        </tr>
                    `;
                }).join('');
            } catch (e) {
                console.error('Failed to load logs', e);
            }
        }

        async function clearLogs() {
            if (!confirm('Are you sure you want to clear all logs?')) return;

            try {
                await fetch(`${API_URL}/api/logs`, { method: 'DELETE' });
                showToast('Logs cleared', 'success');
                loadLogs();
                refreshStats();
            } catch (e) {
                showToast('Failed to clear logs', 'error');
            }
        }

        // Patterns
        async function loadPatterns() {
            try {
                const res = await fetch(`${API_URL}/api/patterns`);
                const data = await res.json();

                const grid = document.getElementById('patternsGrid');
                grid.innerHTML = data.patterns.map(p => {
                    const severityClass = p.severity.toLowerCase();
                    return `
                        <div class="pattern-card">
                            <div class="pattern-name">
                                <span class="severity-badge ${severityClass}">${p.severity}</span>
                                ${p.name}
                            </div>
                            <div class="pattern-desc">${p.description}</div>
                            <div class="pattern-regex">${p.pattern}</div>
                        </div>
                    `;
                }).join('');
            } catch (e) {
                console.error('Failed to load patterns', e);
            }
        }

        // Settings
        async function loadSettings() {
            try {
                const res = await fetch(`${API_URL}/api/config`);
                const config = await res.json();

                document.getElementById('settingProvider').value = config.active_provider || 'azure_openai';
                document.getElementById('settingMaxSize').value = config.file_size_limits?.max_content_size_mb || 1;
                document.getElementById('settingRateLimit').value = config.rate_limiting?.requests_per_minute || 10;
                document.getElementById('settingKeywords').value = (config.blocked_keywords || []).join('\n');

                currentMode = config.local_llm_mode || 'mock';
                updateModeUI();
            } catch (e) {
                console.error('Failed to load settings', e);
            }
        }

        async function saveProviderKey() {
            const provider = document.getElementById('settingProvider').value;
            const apiKey = document.getElementById('settingAPIKey').value;

            if (!apiKey) {
                showToast('Please enter an API key', 'error');
                return;
            }

            try {
                await fetch(`${API_URL}/api/providers/set-active?provider=${provider}`, {
                    method: 'POST'
                });

                await fetch(`${API_URL}/api/providers/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        provider: provider,
                        api_key: apiKey,
                        enabled: true
                    })
                });

                showToast(`${provider} configured and set as active provider`, 'success');
                document.getElementById('settingAPIKey').value = '';
            } catch (e) {
                showToast('Failed to save provider configuration', 'error');
            }
        }

        async function saveSettings() {
            const config = {
                active_provider: document.getElementById('settingProvider').value,
                file_size_limits: {
                    max_content_size_mb: parseInt(document.getElementById('settingMaxSize').value)
                },
                rate_limiting: {
                    requests_per_minute: parseInt(document.getElementById('settingRateLimit').value)
                },
                blocked_keywords: document.getElementById('settingKeywords').value.split('\n').filter(k => k.trim())
            };

            try {
                await fetch(`${API_URL}/api/config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                showToast('Settings saved successfully', 'success');
            } catch (e) {
                showToast('Failed to save settings', 'error');
            }
        }

        // Activity Feed
        async function loadRecentActivity() {
            try {
                const res = await fetch(`${API_URL}/api/logs?limit=10`);
                const data = await res.json();

                const feed = document.getElementById('activityFeed');

                if (!data.logs || data.logs.length === 0) {
                    feed.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>No recent activity</p>
                        </div>
                    `;
                    return;
                }

                feed.innerHTML = data.logs.map(log => {
                    let iconClass = 'allowed';
                    let icon = 'check-circle';
                    let title = 'Allowed to external API';

                    if (log.action === 'BLOCKED') {
                        iconClass = 'blocked';
                        icon = 'ban';
                        title = 'Blocked - Sensitive data';
                    } else if (log.action === 'ROUTED_LOCAL_LLM') {
                        iconClass = 'local';
                        icon = 'server';
                        title = 'Routed to Local LLM';
                    }

                    const time = new Date(log.timestamp).toLocaleTimeString();

                    return `
                        <div class="activity-item">
                            <div class="activity-icon ${iconClass}"><i class="fas fa-${icon}"></i></div>
                            <div class="activity-text">
                                <div class="activity-title">${title}</div>
                                <div class="activity-time">${time} - ${log.user_id || 'anonymous'}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (e) {
                console.error('Failed to load activity', e);
            }
        }

        // Toast
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';

            toast.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            refreshStats();
            loadSettings();
            renderPatternList();
        });
    </script>
</body>
</html>
